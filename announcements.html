<!DOCTYPE html>
<html lang="ru" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Заметки | Eric North</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], serif: ['Lora', 'serif'] },
                    colors: {
                        'paper-light': '#fdfbf7',
                        'paper-dark': '#0f172a',
                    }
                }
            }
        }
    </script>

    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Lora:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .serif-font { font-family: 'Lora', serif; }
        .fade-in-up { animation: fadeInUp 0.5s ease-out forwards; opacity: 0; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* --- ЭФФЕКТ БУМАГИ --- */
        .crumpled-paper-bg {
            background-color: #fdfbf7;
            position: relative;
        }
        .crumpled-paper-bg::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: -1;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.5'/%3E%3C/svg%3E");
            opacity: 0.4;
            mix-blend-mode: multiply;
        }
        .dark .crumpled-paper-bg {
            background-color: #0f172a;
        }
        .dark .crumpled-paper-bg::before {
            opacity: 0.15;
            mix-blend-mode: overlay;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='1'/%3E%3C/svg%3E");
        }
    </style>
</head>

<body class="crumpled-paper-bg text-gray-800 dark:text-slate-300 antialiased flex flex-col min-h-screen transition-colors duration-300">

    <header class="fixed w-full bg-white/80 dark:bg-slate-900/80 backdrop-blur-md z-50 border-b border-gray-200/50 dark:border-slate-800/50 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-24">
                <div class="flex items-center">
                    <a href="index.html" class="flex-shrink-0 flex items-center gap-4 cursor-pointer group">
                        <svg class="w-14 h-14 transform group-hover:translate-y-[-2px] transition duration-300 drop-shadow-sm" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M50 5 L15 60 L50 95 L50 5 Z" class="fill-[#1F2937] dark:fill-slate-100 transition-colors"/>
                            <path d="M50 5 L85 60 L50 95 L50 5 Z" fill="#059669"/>
                            <path d="M50 40 L50 85" class="stroke-white dark:stroke-slate-900 transition-colors" stroke-width="4" stroke-linecap="round"/>
                        </svg>
                        <span class="font-bold text-2xl tracking-tight text-gray-900 dark:text-white group-hover:text-emerald-700 dark:group-hover:text-emerald-400 transition serif-font">Eric North</span>
                    </a>

                    <nav class="hidden md:ml-12 md:flex space-x-8">
                        <a href="index.html" class="text-gray-500 dark:text-slate-400 hover:text-emerald-600 dark:hover:text-emerald-400 px-3 py-2 text-sm font-medium transition" data-lang-key="nav_index">Главная</a>
                        <a href="blog.html" class="text-gray-500 dark:text-slate-400 hover:text-emerald-600 dark:hover:text-emerald-400 px-3 py-2 text-sm font-medium transition" data-lang-key="nav_blog">Истории</a>
                        <a href="books.html" class="text-gray-500 dark:text-slate-400 hover:text-emerald-600 dark:hover:text-emerald-400 px-3 py-2 text-sm font-medium transition" data-lang-key="nav_books">Книги</a>
                        <a href="announcements.html" class="text-emerald-600 dark:text-emerald-400 px-3 py-2 text-sm font-medium transition" data-lang-key="nav_notes">Заметки</a>
                    </nav>
                </div>

                <div class="hidden md:flex items-center space-x-3">
                    <button onclick="toggleTheme()" class="p-2 text-gray-400 hover:text-emerald-600 dark:hover:text-emerald-400 transition rounded-full hover:bg-gray-100 dark:hover:bg-slate-800">
                        <svg class="w-6 h-6 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                        <svg class="w-6 h-6 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                    </button>
                    <div class="h-6 w-px bg-gray-200 dark:bg-slate-700 mx-1"></div>
                    <button onclick="toggleLanguage()" class="text-xs font-bold uppercase tracking-wider text-gray-400 hover:text-emerald-600 dark:hover:text-emerald-400 transition border border-gray-200 dark:border-slate-700 rounded px-2 py-1" id="lang-btn">RU</button>
                    <button onclick="openSearch()" class="p-2 text-gray-400 hover:text-emerald-600 dark:hover:text-emerald-400 transition rounded-full hover:bg-gray-100 dark:hover:bg-slate-800">
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                    </button>
                    <a href="contact.html" class="bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-2.5 rounded-full text-sm font-semibold transition shadow-lg shadow-emerald-200 dark:shadow-none ml-2" data-lang-key="btn_subscribe">Подписаться</a>
                </div>

                <div class="-mr-2 flex items-center md:hidden gap-2">
                    <button onclick="toggleTheme()" class="p-2 text-gray-400 dark:text-slate-400">
                        <svg class="w-6 h-6 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                        <svg class="w-6 h-6 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                    </button>
                    <button onclick="toggleLanguage()" class="text-xs font-bold uppercase tracking-wider text-gray-400 border border-gray-200 dark:border-slate-700 rounded px-2 py-1" id="lang-btn-mobile">RU</button>
                    <button type="button" onclick="toggleMenu()" class="bg-white dark:bg-slate-800 rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-emerald-500"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg></button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white dark:bg-slate-900 border-t border-gray-100 dark:border-slate-800 absolute w-full shadow-xl">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="blog.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-slate-300 hover:bg-gray-50 dark:hover:bg-slate-800" data-lang-key="nav_blog">Истории</a>
                <a href="books.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-slate-300 hover:bg-gray-50 dark:hover:bg-slate-800" data-lang-key="nav_books">Книги</a>
                <a href="announcements.html" class="block px-3 py-2 rounded-md text-base font-medium text-emerald-600 bg-emerald-50 dark:bg-emerald-900/20 dark:text-emerald-400" data-lang-key="nav_notes">Заметки</a>
            </div>
        </div>
    </header>

    <main class="pt-32 pb-20 flex-grow transition-colors duration-300">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-8 fade-in-up">
                <h1 class="text-4xl font-extrabold text-gray-900 dark:text-white sm:text-5xl serif-font mb-4" data-lang-key="page_title">Ежедневный Дайжест</h1>
                <p class="text-xl text-gray-500 dark:text-slate-400 max-w-2xl mx-auto" data-lang-key="page_subtitle">Мысли, наблюдения и спонтанные идеи.</p>
            </div>

            <div class="flex flex-wrap gap-2 justify-center md:justify-start mb-12 fade-in-up" style="animation-delay: 0.1s">
                <button onclick="setFilter('all')" id="filter-all" class="px-4 py-2 rounded-full text-sm font-semibold transition-all shadow-sm bg-emerald-600 text-white hover:bg-emerald-700" data-lang-key="filter_all">Все</button>
                <button onclick="setFilter('brain')" id="filter-brain" class="px-4 py-2 rounded-full text-sm font-semibold transition-all shadow-sm bg-white dark:bg-slate-800 text-gray-600 dark:text-slate-300 border border-gray-200 dark:border-slate-700 hover:border-emerald-500 hover:text-emerald-600 dark:hover:text-emerald-400" data-lang-key="filter_brain">Мозговой штурм</button>
                <button onclick="setFilter('observation')" id="filter-observation" class="px-4 py-2 rounded-full text-sm font-semibold transition-all shadow-sm bg-white dark:bg-slate-800 text-gray-600 dark:text-slate-300 border border-gray-200 dark:border-slate-700 hover:border-emerald-500 hover:text-emerald-600 dark:hover:text-emerald-400" data-lang-key="filter_observation">Наблюдение</button>
                <button onclick="setFilter('thoughts')" id="filter-thoughts" class="px-4 py-2 rounded-full text-sm font-semibold transition-all shadow-sm bg-white dark:bg-slate-800 text-gray-600 dark:text-slate-300 border border-gray-200 dark:border-slate-700 hover:border-emerald-500 hover:text-emerald-600 dark:hover:text-emerald-400" data-lang-key="filter_thoughts">Мысли вслух</button>
            </div>
            
            <div class="relative">
                <div class="absolute left-8 md:left-1/2 h-full w-px bg-emerald-300 dark:bg-emerald-900/50 transform md:-translate-x-1/2 shadow-sm"></div>
                <div id="notes-list" class="space-y-6">
                    </div>
            </div>
        </div>
    </main>

    <footer class="bg-emerald-900 text-white border-t border-emerald-800 mt-auto">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-center text-center md:text-left">
                <div>
                    <span class="font-bold text-xl tracking-tight block mb-2 serif-font">Eric North</span>
                    <span class="text-emerald-200/60 text-sm">© 2025. All rights reserved.</span>
                </div>
                <div class="flex justify-center space-x-6 text-sm font-medium text-emerald-100">
                    <a href="blog.html" class="hover:text-white transition" data-lang-key="nav_blog">Истории</a>
                    <a href="books.html" class="hover:text-white transition" data-lang-key="nav_books">Книги</a>
                    <a href="contact.html" class="hover:text-white transition" data-lang-key="btn_subscribe">Подписаться</a>
                </div>
                <div class="flex justify-center md:justify-end space-x-5">
                    <a href="https://t.me/ВАШ_НИК" target="_blank" class="text-emerald-200 hover:text-white transition transform hover:scale-110">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
                    </a>
                    <a href="https://wa.me/ВАШ_НОМЕР" target="_blank" class="text-emerald-200 hover:text-white transition transform hover:scale-110">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
                    </a>
                    <a href="https://youtube.com/@ВАШ_КАНАЛ" target="_blank" class="text-emerald-200 hover:text-white transition transform hover:scale-110">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                    </a>
                    <a href="https://x.com/ВАШ_НИК" target="_blank" class="text-emerald-200 hover:text-white transition transform hover:scale-110">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <div id="search-overlay" class="fixed inset-0 bg-white/95 dark:bg-slate-900/95 backdrop-blur-xl z-[100] hidden flex flex-col pt-24 px-4 sm:px-6 lg:px-8 transition-opacity duration-300 opacity-0">
        <button onclick="closeSearch()" class="absolute top-6 right-6 p-2 text-gray-400 hover:text-gray-900 dark:hover:text-white rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition"><svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
        <div class="max-w-3xl mx-auto w-full">
            <input type="text" id="search-input" placeholder="Search..." class="w-full text-3xl sm:text-5xl font-bold border-b-2 border-gray-200 dark:border-slate-700 py-4 focus:outline-none focus:border-emerald-600 bg-transparent text-gray-900 dark:text-white placeholder-gray-300 dark:placeholder-slate-600 transition-colors" oninput="performSearch(this.value)">
            <div id="search-results" class="mt-12 space-y-8 overflow-y-auto max-h-[60vh] pb-20"></div>
        </div>
    </div>

    <script src="data_home.js"></script>
    <script src="data_blog.js"></script>
    <script src="data_books.js"></script>
    <script src="data_notes.js"></script>
    <script src="data_hidden.js"></script>
    <script src="database.js"></script>

    <script>
        // === ПЕРЕКЛЮЧЕНИЕ ТЕМЫ ===
        function toggleTheme() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
        }

        const translations = {
            ru: { nav_index: "Главная", nav_blog: "Истории", nav_books: "Книги", nav_notes: "Заметки", btn_subscribe: "Подписаться", page_title: "Ежедневный Дайджест", page_subtitle: "Мысли, наблюдения и спонтанные идеи.", filter_all: "Все", filter_brain: "Мозговой штурм", filter_observation: "Наблюдение", filter_thoughts: "Мысли вслух" },
            en: { nav_index: "Home", nav_blog: "Stories", nav_books: "Books", nav_notes: "Notes", btn_subscribe: "Subscribe", page_title: "Daily Digest", page_subtitle: "Thoughts, observations, and spontaneous ideas.", filter_all: "All", filter_brain: "Brainstorm", filter_observation: "Observation", filter_thoughts: "Thoughts" }
        };

        // СЛОВАРЬ (ОБНОВЛЕННЫЙ)
        const typeTranslations = {
            ru: { progress: "мозговой штурм", brain: "мозговой штурм", image: "наблюдение", idea: "наблюдение", text: "мысли вслух", note: "мысли вслух" },
            en: { progress: "brainstorm", brain: "brainstorm", image: "observation", idea: "observation", text: "thoughts", note: "thoughts" }
        };

        const lang = localStorage.getItem('site_lang') || 'ru';
        document.getElementById('lang-btn').innerText = lang.toUpperCase();
        document.querySelectorAll('[data-lang-key]').forEach(el => el.innerText = translations[lang][el.getAttribute('data-lang-key')]);
        
        function toggleLanguage() { localStorage.setItem('site_lang', lang === 'ru' ? 'en' : 'ru'); location.reload(); }
        function toggleMenu() { document.getElementById('mobile-menu').classList.toggle('hidden'); }

        function formatRelativeDate(dateString) {
            let date;
            const lang = getLanguage();
            if (lang === 'ru') {
                const parts = dateString.split('-');
                if (parts.length === 3) {
                    date = new Date(parts[2], parts[1] - 1, parts[0]);
                } else {
                    date = new Date(dateString);
                }
            } else {
                date = new Date(dateString);
            }
            if (isNaN(date.getTime())) return dateString;

            const now = new Date();
            const dateMidnight = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            const nowMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate());

            const diffTime = nowMidnight - dateMidnight;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays === 0) return lang === 'ru' ? 'Сегодня' : 'Today';
            if (diffDays === 1) return lang === 'ru' ? 'Вчера' : 'Yesterday';
            
            if (lang === 'ru') {
                if (diffDays > 1 && diffDays < 5) return `${diffDays} дня назад`;
                if (diffDays >= 5 && diffDays < 30) return `${diffDays} дней назад`;
            } else {
                if (diffDays > 1 && diffDays < 30) return `${diffDays} days ago`;
            }

            return date.toLocaleDateString(lang === 'ru' ? 'ru-RU' : 'en-US', {
                day: 'numeric', month: 'long', year: 'numeric'
            });
        }

        function getLanguage() {
            return localStorage.getItem('site_lang') || 'ru';
        }

        const list = document.getElementById('notes-list');
        let allNotesData = []; // Храним загруженные данные

        // Загрузка данных (Убрана надпись Loading...)
        loadGoogleSheet('notes').then(notes => {
            allNotesData = notes;
            renderNotes(allNotesData); // Рисуем всё сразу
        });

        // === ФУНКЦИЯ ФИЛЬТРАЦИИ ===
        function setFilter(filterType) {
            // Обновляем стили кнопок
            const buttons = ['all', 'brain', 'observation', 'thoughts'];
            buttons.forEach(btn => {
                const el = document.getElementById(`filter-${btn}`);
                if (btn === filterType) {
                    // Активная кнопка
                    el.className = "px-4 py-2 rounded-full text-sm font-semibold transition-all shadow-sm bg-emerald-600 text-white hover:bg-emerald-700";
                } else {
                    // Неактивная кнопка
                    el.className = "px-4 py-2 rounded-full text-sm font-semibold transition-all shadow-sm bg-white dark:bg-slate-800 text-gray-600 dark:text-slate-300 border border-gray-200 dark:border-slate-700 hover:border-emerald-500 hover:text-emerald-600 dark:hover:text-emerald-400";
                }
            });

            // Фильтруем данные
            if (filterType === 'all') {
                renderNotes(allNotesData);
            } else {
                const filtered = allNotesData.filter(note => {
                    const t = note.type;
                    if (filterType === 'brain') return t === 'progress' || t === 'brain';
                    if (filterType === 'observation') return t === 'image' || t === 'idea';
                    if (filterType === 'thoughts') return t === 'text' || t === 'note';
                    return false;
                });
                renderNotes(filtered);
            }
        }

        // === ФУНКЦИЯ ОТРИСОВКИ ===
        function renderNotes(notes) {
            list.innerHTML = '';
            
            if (notes.length === 0) {
                // Текст "Нет заметок" переводим вручную в зависимости от текущего языка
                const noNotesText = getLanguage() === 'ru' ? 'Нет заметок в этой категории.' : 'No notes in this category.';
                list.innerHTML = `<div class="text-center text-gray-400 py-10 fade-in-up">${noNotesText}</div>`;
                return;
            }

            notes.forEach((note, index) => {
                let contentHtml = '';
                let iconSvg = '';
                
                // Логика иконок
                if (note.type === 'progress' || note.type === 'brain') {
                    // МОЗГ
                    iconSvg = `<svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>`;
                    if (note.percent) {
                         contentHtml = `
                        <div class="mt-4">
                            <div class="flex justify-between text-sm font-semibold mb-1 text-gray-600 dark:text-slate-400">
                                <span>Status</span>
                                <span class="text-emerald-600 dark:text-emerald-400">${note.percent}%</span>
                            </div>
                            <div class="w-full bg-gray-100 dark:bg-slate-700 rounded-full h-3 overflow-hidden shadow-inner">
                                <div class="bg-gradient-to-r from-emerald-500 to-emerald-400 h-3 rounded-full transition-all duration-1000 ease-out" style="width: ${note.percent}%"></div>
                            </div>
                        </div>`;
                    }
                } else if (note.type === 'image' || note.type === 'idea') {
                    // ЛАМПОЧКА
                    iconSvg = `<svg class="w-5 h-5 text-yellow-500 dark:text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>`;
                    if (note.image) {
                        contentHtml = `
                        <div class="mt-5 rounded-xl overflow-hidden shadow-md group-hover:shadow-lg transition-all duration-300 border border-gray-100 dark:border-slate-700">
                            <img src="${note.image}" class="w-full h-64 object-cover transform group-hover:scale-105 transition duration-700" alt="${note.title}">
                        </div>`;
                    }
                } else {
                    // ЗАМЕТКА
                    iconSvg = `<svg class="w-5 h-5 text-blue-500 dark:text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>`;
                }

                const isEven = index % 2 === 0;
                const containerClass = isEven ? 'md:flex-row' : 'md:flex-row-reverse';
                const dateClass = isEven ? 'md:text-right md:pr-12' : 'md:text-left md:pl-12';
                const cardClass = isEven ? 'md:ml-12' : 'md:mr-12';
                
                // Стиль диалога
                const bubbleShapeClass = isEven ? 'rounded-tl-none md:rounded-tl-none' : 'rounded-tr-none md:rounded-tr-none';
                const arrowPositionClass = isEven ? '-left-2 md:-left-2' : '-left-2 md:left-auto md:-right-2'; 
                const arrowBorderClass = isEven ? 'border-l border-b' : 'md:border-l-0 md:border-b-0 md:border-r md:border-t border-l border-b';

                const typeText = typeTranslations[lang][note.type] || note.type;
                const displayDate = formatRelativeDate(note.date);

                list.innerHTML += `
                    <div class="relative flex flex-col items-center ${containerClass} md:justify-between group fade-in-up" style="animation-delay: ${index * 100}ms">
                        <div class="absolute left-8 md:left-1/2 w-12 h-12 rounded-full border-4 border-white dark:border-slate-900 bg-white dark:bg-slate-800 flex items-center justify-center shadow-md z-10 transform -translate-x-1/2 md:translate-x-[calc(-50%+0.5px)] transition-transform duration-300 group-hover:scale-110 group-hover:border-emerald-200 dark:group-hover:border-emerald-800">
                            ${iconSvg}
                        </div>
                        <div class="w-full md:w-1/2 pl-20 md:pl-0 ${dateClass} mb-2 md:mb-0">
                            <span class="text-sm font-bold text-gray-400 dark:text-slate-500 uppercase tracking-widest transition-colors duration-300 group-hover:text-emerald-500 shadow-sm bg-white/60 dark:bg-slate-900/60 rounded px-2 backdrop-blur-sm border border-gray-100 dark:border-slate-800">${displayDate}</span>
                        </div>
                        <div class="w-full md:w-1/2 pl-16 md:pl-0">
                            <div class="${cardClass} ${bubbleShapeClass} bg-white dark:bg-slate-800 p-6 rounded-3xl shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 dark:border-slate-700 relative">
                                <div class="absolute top-0 w-4 h-4 bg-white dark:bg-slate-800 transform rotate-45 border-gray-100 dark:border-slate-700 ${arrowPositionClass} ${arrowBorderClass} mt-6"></div>
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-xs font-bold px-2 py-0.5 rounded bg-gray-100 dark:bg-slate-700 text-gray-500 dark:text-slate-400 uppercase tracking-wide">${typeText}</span>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2 serif-font group-hover:text-emerald-700 dark:group-hover:text-emerald-400 transition-colors">${note.title}</h3>
                                <p class="text-gray-600 dark:text-slate-300 leading-relaxed text-sm">${note.desc}</p>
                                ${contentHtml}
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        const overlay = document.getElementById('search-overlay'); const input = document.getElementById('search-input'); const resultsContainer = document.getElementById('search-results');
        function openSearch() { overlay.classList.remove('hidden'); setTimeout(() => { overlay.classList.remove('opacity-0'); input.focus(); }, 50); document.body.style.overflow = 'hidden'; }
        function closeSearch() { overlay.classList.add('opacity-0'); setTimeout(() => { overlay.classList.add('hidden'); input.value = ''; resultsContainer.innerHTML = ''; }, 300); document.body.style.overflow = ''; }
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeSearch(); });
        function performSearch(query) {
            if (!query || query.length < 2) { resultsContainer.innerHTML = '<div class="text-center text-gray-400 mt-10">Введите минимум 2 символа...</div>'; return; }
            query = query.toLowerCase(); let matches = [];
            loadGoogleSheet('blog').then(posts => {
                posts.forEach(post => { if (post.title.toLowerCase().includes(query) || post.desc.toLowerCase().includes(query)) matches.push({ type: 'История', title: post.title, desc: post.desc, link: `post.html?id=${post.id}`, color: 'text-emerald-600' }); });
                loadGoogleSheet('books').then(books => {
                    books.forEach(book => { if (book.title.toLowerCase().includes(query) || book.desc.toLowerCase().includes(query)) matches.push({ type: 'Книга', title: book.title, desc: book.desc, link: book.link || 'books.html', color: 'text-indigo-600' }); });
                    loadGoogleSheet('notes').then(notes => {
                        notes.forEach(note => { if (note.title.toLowerCase().includes(query) || (note.desc && note.desc.toLowerCase().includes(query))) matches.push({ type: 'Заметка', title: note.title, desc: note.desc, link: 'announcements.html', color: 'text-amber-600' }); });
                        if (matches.length === 0) resultsContainer.innerHTML = '<div class="text-center text-gray-500 mt-10">Ничего не найдено.</div>';
                        else { resultsContainer.innerHTML = ''; matches.forEach(item => { resultsContainer.innerHTML += `<a href="${item.link}" onclick="closeSearch()" class="block group border-b border-gray-100 dark:border-slate-700 pb-6 hover:bg-gray-50 dark:hover:bg-slate-800 p-4 -mx-4 rounded-xl transition"><div class="flex items-center gap-3 mb-1"><span class="text-xs font-bold uppercase tracking-wider ${item.color}">${item.type}</span></div><h3 class="text-xl font-bold text-gray-900 dark:text-white group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition">${item.title}</h3><p class="text-gray-500 dark:text-slate-400 mt-1 line-clamp-2">${item.desc}</p></a>`; }); }
                    });
                });
            });
        }
    </script>
</body>
</html>